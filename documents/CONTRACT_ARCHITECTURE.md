# Contract Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              EXTERNAL                                       │
│                                                                             │
│     ┌──────────┐                                    ┌──────────┐            │
│     │   User   │                                    │  Admin   │            │
│     └────┬─────┘                                    └────┬─────┘            │
│          │                                               │                  │
└──────────┼───────────────────────────────────────────────┼──────────────────┘
           │                                               │
           │  deposit / withdraw / renew                   │  createPlan / pausePlan
           │                                               │  deposit / withdraw (vault)
           ▼                                               ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                            ┌─────────────────┐                              │
│                            │                 │                              │
│                            │   SavingBank    │                              │
│                            │                 │                              │
│                            │  - savingPlans  │                              │
│                            │  - deposits     │                              │
│                            │                 │                              │
│                            └───────┬─────────┘                              │
│                                    │                                        │
│                 ┌──────────────────┼──────────────────┐                     │
│                 │                  │                  │                     │
│                 ▼                  ▼                  ▼                     │
│    ┌────────────────────┐  ┌─────────────┐  ┌──────────────────┐            │
│    │                    │  │             │  │                  │            │
│    │ DepositCertificate │  │    Vault    │  │InterestCalculator│            │
│    │      (ERC721)      │  │             │  │    (Library)     │            │
│    │                    │  │  - balance  │  │                  │            │
│    │  - mint            │  │  - deposit  │  │  - calculate     │            │
│    │  - burn            │  │  - withdraw │  │    Interest      │            │
│    │  - ownerOf         │  │  - payUser  │  │  - calculate     │            │
│    │                    │  │             │  │    Penalty       │            │
│    └────────────────────┘  └──────┬──────┘  └──────────────────┘            │
│                                   │                                         │
│                                   ▼                                         │
│                            ┌──────────────┐                                 │
│                            │              │                                 │
│                            │   MockUSDC   │                                 │
│                            │   (ERC20)    │                                 │
│                            │              │                                 │
│                            └──────────────┘                                 │
│                                                                             │
│                              CONTRACTS                                      │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                              INTERFACES                                     │
│                                                                             │
│                         ┌─────────────────┐                                 │
│                         │   SavingBank    │                                 │
│                         └────────┬────────┘                                 │
│                                  │                                          │
│          ┌───────────┬───────────┼───────────┬──────────────┐               │
│          ▼           ▼           ▼           ▼              ▼               │
│   ┌────────────┐ ┌────────┐ ┌────────┐ ┌──────────┐   ┌────────────┐        │
│   │ISavingBank │ │ISaving │ │ISaving │ │ISaving   │   │ ISavingBank│        │
│   │   Admin    │ │BankUser│ │BankView│ │BankEvents│   │ Errors     │        │
│   └────────────┘ └────────┘ └────────┘ └──────────┘   └────────────┘        │
│                                                                             │
│                                │                                            │
│                                ▼                                            │
│                       ┌──────────────────┐                                  │
│                       │ISavingBankStructs│                                  │
│                       │                  │                                  │
│                       │  - SavingPlan    │                                  │
│                       │  - Deposit       │                                  │
│                       └──────────────────┘                                  │
│                                                                             │
│   ┌────────────────────┐              ┌─────────────────────┐               │
│   │IDepositCertificate │              │       IVault        │               │
│   └────────────────────┘              │     IVaultEvents    │               │
│                                       └─────────────────────┘               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                              DATA FLOW                                      │
│                                                                             │
│   User deposits USDC                                                        │
│   ─────────────────                                                         │
│                                                                             │
│   User ──USDC──▶ SavingBank ──USDC──▶ Vault                                 │
│                      │                                                      │
│                      ▼                                                      │
│            DepositCertificate ──NFT──▶ User                                 │
│                                                                             │
│                                                                             │
│   User withdraws (matured)                                                  │
│   ────────────────────────                                                  │
│                                                                             │
│   User ──NFT──▶ SavingBank ──burn──▶ DepositCertificate                     │
│                      │                                                      │
│                      ▼                                                      │
│                   Vault ──USDC (principal + interest)──▶ User               │
│                                                                             │
│                                                                             │
│   User withdraws (early)                                                    │
│   ──────────────────────                                                    │
│                                                                             │
│   User ──NFT──▶ SavingBank ──burn──▶ DepositCertificate                     │
│                      │                                                      │
│                      ▼                                                      │
│                   Vault ──USDC (principal - penalty)──▶ User                │
│                                                                             │
│                                                                             │
│   Admin funds Vault                                                         │
│   ─────────────────                                                         │
│                                                                             │
│   Admin ──USDC──▶ SavingBank ──USDC──▶ Vault                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                              ACCESS CONTROL                                 │
│                                                                             │
│                        ┌─────────────────┐                                  │
│                        │   SavingBank    │                                  │
│                        └────────┬────────┘                                  │
│                                 │                                           │
│              ┌──────────────────┴──────────────────┐                        │
│              ▼                                     ▼                        │
│     ┌─────────────────┐                   ┌─────────────────┐               │
│     │  DEFAULT_ADMIN  │                   │  OPERATOR_ROLE  │               │
│     │                 │                   │                 │               │
│     │  - grantRole    │                   │  - createPlan   │               │
│     │  - revokeRole   │                   │  - updatePlan   │               │
│     │  - pause        │                   │  - pausePlan    │               │
│     │  - unpause      │                   │  - unpausePlan  │               │
│     └─────────────────┘                   └─────────────────┘               │
│                                                                             │
│                        ┌─────────────────┐                                  │
│                        │      Vault      │                                  │
│                        └────────┬────────┘                                  │
│                                 │                                           │
│              ┌──────────────────┴──────────────────┐                        │
│              ▼                                     ▼                        │
│     ┌─────────────────┐                   ┌─────────────────┐               │
│     │  DEFAULT_ADMIN  │                   │  SAVING_BANK    │               │
│     │                 │                   │   (Contract)    │               │
│     │  - deposit      │                   │                 │               │
│     │  - withdraw     │                   │  - payUser      │               │
│     │  - setBank      │                   │                 │               │
│     └─────────────────┘                   └─────────────────┘               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```
